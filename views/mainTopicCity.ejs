<% 
String.prototype.interpolate = function(params) {
  const names = Object.keys(params);
  const vals = Object.values(params);
  return new Function(...names, `return \`${this}\`;`)(...vals);
}

function isSet(x) {
	return typeof x !== null && x != null && x != "" && x != [] && x != {};
}
%>

<%- include('partials/aboveContentHTML') -%>

<%- include('partials/breadcrumb') -%>

<% 
	function plainTextToHTML(text) {
		return `<p>${text.replaceAll(/\n+/g, "</p><p>")}</p>`;
	}
%>

<h1><a href=""><%= topic.slug.replaceAll("-", " ") %> in <%= cityStateCountry.city %>, <%= cityStateCountry.state %> <%= new Date().getFullYear() %></a></h1>

<%- plainTextToHTML(topic.blurb).interpolate({city: cityStateCountry.city, state: cityStateCountry.state, country: cityStateCountry.country}) %>

<% subTopics.forEach(t => { %>
	<% if (isSet(t) && isSet(cityStateCountry) && isSet(t.slug) && isSet(cityStateCountry.city) && isSet(cityStateCountry.state) && isSet(cityStateCountry.country)) {%>
		<h2><%= t.slug.replaceAll("-", " ") %> in <%= cityStateCountry.city %></h2>
		<%- plainTextToHTML(t.blurb).interpolate({city: cityStateCountry.city, state: cityStateCountry.state, country: cityStateCountry.country}) %>
	<% } %>
<% }) %>

<%= `topic: ${JSON.stringify(topic)}\ncityStateCountryCombos: ${JSON.stringify(cityStateCountryCombos)}`%>
<%- include('partials/belowContentHTML', {topic, cityStateCountryCombos}) -%>
